import{j as e,r as c,c as E}from"./client-C_2d_5tV.js";const R=()=>e.jsx("header",{className:"text-center flex-shrink-0 mb-2",children:e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold tracking-tighter",children:e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500",children:"星途成长方舟"})})}),M=({title:t,children:s,rightSlot:r})=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-lg h-full flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-3 items-center px-3 py-3 border-b border-slate-700/50 flex-shrink-0",children:[e.jsx("div",{}),e.jsx("div",{className:"text-xl font-bold text-center",children:t}),e.jsx("div",{className:"justify-self-end",children:r})]}),e.jsx("div",{className:"p-2 sm:p-3 overflow-y-auto flex-grow min-h-0",children:s})]}),$=t=>{const s=f=>Math.floor(100*Math.pow(1.25,Math.max(0,f-1)));let r=0,l=1;for(;t-r>=s(l);)r+=s(l),l+=1;const o=s(l),i=Math.max(0,Math.min(1,(t-r)/o));return{level:l,progress:Math.round(i*100)}},z=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",...t,children:e.jsx("path",{d:"M313.4 32.9c26-5.2 42.9 20.5 37.7 46.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 502 288.9 502 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H128c-26.5 0-48-21.5-48-48c0-3.6 .4-7.1 1.1-10.4C62.9 457.4 49 439.3 49 418c0-9.1 2.5-17.6 6.9-24.9C33.8 388.9 17 369.4 17 348c0-15.1 5-28.6 13.9-39.4C10.5 298.6 0 282.5 0 264c0-26.5 21.5-48 48-48h143.6c-13.7-23.1-23.5-48.5-28.8-75.2l-2.3-11.4c-5.2-26 11.7-51.7 37.7-46.5l24.1 4.8c12.1 2.4 24.1 2.4 36.2 0l24.1-4.8z"})}),D=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:[e.jsx("path",{d:"M9.25 13.25a.75.75 0 0 0 1.5 0V4.636l2.955 3.129a.75.75 0 0 0 1.09-1.03l-4.25-4.5a.75.75 0 0 0-1.09 0l-4.25 4.5a.75.75 0 1 0 1.09 1.03L9.25 4.636v8.614Z"}),e.jsx("path",{d:"M3.5 12.75a.75.75 0 0 0-1.5 0v2.5A2.75 2.75 0 0 0 4.75 18h10.5A2.75 2.75 0 0 0 18 15.25v-2.5a.75.75 0 0 0-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5Z"})]}),P=({student:t,onAvatarChange:s,className:r})=>{const l=c.useRef(null),o=i=>{var d;const f=(d=i.target.files)==null?void 0:d[0];if(!f)return;if(f.size>1024*1024){alert("图片大小不能超过 1MB");return}const m=new FileReader;m.onload=n=>{var h;const a=(h=n.target)==null?void 0:h.result;typeof a=="string"&&s(t.id,a)},m.readAsDataURL(f)};return e.jsxs("div",{className:`relative group flex-shrink-0 ${r}`,onClick:()=>{var i;return(i=l.current)==null?void 0:i.click()},children:[e.jsx("img",{src:t.avatar_url,alt:t.name,className:"w-full h-full rounded-full object-cover group-hover:opacity-60 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:e.jsx(D,{})}),e.jsx("input",{type:"file",ref:l,className:"hidden",accept:"image/png, image/jpeg, image/webp",onChange:o})]})},H=({student:t,team:s,onAvatarChange:r})=>{const{level:l}=$(t.total_exp);return e.jsx("div",{className:"p-3 rounded-xl mb-2 bg-gradient-to-br from-yellow-800/30 via-slate-800/20 to-slate-800/20 border-2 border-yellow-400/80",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx(P,{student:t,onAvatarChange:r,className:"w-16 h-16 border-4 border-yellow-400 shadow-lg rounded-full"}),e.jsx(z,{className:"w-8 h-8 text-yellow-300 absolute -top-3 right-0 transform rotate-12 z-20"})]}),e.jsxs("div",{className:"flex-grow relative overflow-hidden flex flex-col justify-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-white relative z-10",children:t.name}),e.jsx("p",{className:`text-base font-semibold ${(s==null?void 0:s.textColor)??"text-gray-400"} relative z-10`,children:(s==null?void 0:s.name)??"无战队"}),e.jsx("span",{className:"absolute right-0 -bottom-4 text-7xl font-black text-white opacity-10 select-none z-0 transform",children:"NO.1"})]}),e.jsxs("div",{className:"flex-shrink-0 bg-slate-900/40 rounded-lg px-4 py-1.5 flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-2xl text-blue-400",children:l}),e.jsx("div",{className:"text-xs text-slate-400",children:"等级"})]}),e.jsx("div",{className:"w-px h-10 bg-slate-700"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-black text-yellow-300 tracking-wider",children:t.total_exp.toLocaleString()}),e.jsx("div",{className:"text-xs text-slate-400",children:"经验"})]})]})]})})},L=({students:t,teamsMap:s,onAvatarChange:r})=>{const[l,o]=c.useState(0),[i,f]=c.useState(10),m=c.useRef(null),d=t[0],n=t.slice(1),a=d?s.get(d.team_id):void 0;c.useEffect(()=>{const x=m.current;if(!x||n.length===0)return;const p=new ResizeObserver(()=>{const g=x.clientHeight,j=x.querySelector("li");if(!j)return;const v=j.offsetHeight+8;if(v<=0)return;const b=window.innerWidth>=768,I=b?2:1,N=Math.max(1,Math.floor(g/v))*I;f(k=>N>0&&N!==k?b?Math.floor(N/2)*2:N:k)});return p.observe(x),()=>p.disconnect()},[n.length]);const h=c.useMemo(()=>{const x=[];if(i>0)for(let p=0;p<n.length;p+=i)x.push(n.slice(p,p+i));return x.length>0?x:[[]]},[n,i]),u=h.length;return c.useEffect(()=>{if(u<=1)return;const x=setInterval(()=>{o(p=>(p+1)%u)},5e3);return()=>clearInterval(x)},[u]),t.length===0||!d?e.jsx("div",{className:"text-center p-8 text-slate-500",children:"暂无学生数据"}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx(H,{student:d,team:a,onAvatarChange:r}),e.jsx("div",{className:"h-px bg-slate-700 my-2"}),e.jsx("div",{className:"flex-grow overflow-hidden relative",ref:m,children:e.jsx("div",{className:"flex h-full transition-transform duration-700 ease-in-out",style:{transform:`translateX(-${l*100}%)`},children:h.map((x,p)=>e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 w-full flex-shrink-0 h-full content-start",children:x.map((g,j)=>{s.get(g.team_id);const y=p*i+j+2,{level:v,progress:b}=$(g.total_exp);return e.jsxs("li",{className:"flex flex-col p-2 rounded-lg border border-slate-700/50 bg-slate-800/30 hover:bg-slate-800/50 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("span",{className:"text-3xl font-bold italic w-12 text-yellow-400 text-center",children:y}),e.jsx(P,{student:g,onAvatarChange:r,className:"w-8 h-8 rounded-full mr-2 border border-slate-600"}),e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("div",{className:"font-semibold text-white truncate text-sm",children:g.name}),e.jsxs("div",{className:"flex gap-x-2",children:[e.jsxs("div",{className:"text-xs text-slate-300",children:[g.total_exp.toLocaleString()," 经验"]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[g.total_points.toLocaleString()," 积分"]})]})]}),e.jsx("div",{className:"text-right ml-2",children:e.jsxs("div",{className:"font-bold text-sm text-blue-400",children:["等级 ",v]})})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-1 mt-1.5",children:e.jsx("div",{className:"bg-cyan-400 h-1 rounded-full transition-all duration-500",style:{width:`${b}%`}})})]},g.id)})},p))})})]})},B=({students:t,teams:s,sortBy:r,unit:l})=>{const o=c.useMemo(()=>{const n=new Map;return s.forEach(a=>n.set(a.id,0)),t.forEach(a=>n.set(a.team_id,(n.get(a.team_id)||0)+a[r])),Array.from(n.entries()).map(([a,h])=>({team:s.find(u=>u.id===a),total:h})).filter(a=>!!a.team).sort((a,h)=>h.total-a.total)},[t,s,r]),[i,f]=c.useState(0);c.useEffect(()=>{if(o.length<=1)return;const n=setInterval(()=>f(a=>(a+1)%o.length),4e3);return()=>clearInterval(n)},[o.length]);const m=o[i];if(!m)return null;const d=o[0].total>0?Math.max(5,Math.round(m.total/o[0].total*100)):100;return e.jsx("div",{className:"h-6 overflow-hidden max-w-[33vw] sm:max-w-[260px]",children:e.jsx("div",{className:"transition-transform duration-500",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-5 h-5 rounded-full bg-slate-700 text-xs text-slate-300 flex items-center justify-center",children:i+1}),e.jsx("span",{className:`text-sm font-semibold ${m.team.textColor}`,children:m.team.name}),e.jsx("div",{className:"flex-grow h-2 bg-slate-700 rounded-full",children:e.jsx("div",{className:"h-2 rounded-full bg-cyan-400",style:{width:`${d}%`}})}),e.jsxs("span",{className:"text-[11px] text-slate-400",children:[m.total.toLocaleString()," ",l]})]})})})},A=({challenges:t})=>{const s=t,r=s.length>0?[...s,...s]:[];return e.jsx(M,{title:"挑战擂台",children:r.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:"暂无挑战"}):e.jsxs("div",{className:"h-full overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-max animate-scroll-vertical",children:r.map((l,o)=>e.jsxs("div",{className:"flex items-center p-2 mb-2 bg-slate-800/40 border border-slate-700/50 rounded-lg",children:[e.jsx("img",{src:l.challenger.avatar,alt:l.challenger.name,className:"w-9 h-9 rounded-full border-2 border-purple-400 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsx("h4",{className:"font-bold text-sm text-purple-300 truncate",children:l.title}),e.jsxs("p",{className:"text-xs text-slate-400 truncate",children:["挑战者: ",l.challenger.name]})]}),l.status==="进行中"&&e.jsx("span",{className:"text-xs font-semibold bg-purple-500/50 text-purple-200 px-2 py-0.5 rounded-full ml-2",children:"进行中"}),l.status==="成功"&&e.jsx("span",{className:"text-xs font-semibold bg-emerald-500/80 text-white px-2 py-0.5 rounded-full ml-2",children:"成功"}),l.status==="失败"&&e.jsx("span",{className:"text-xs font-semibold bg-red-500/80 text-white px-2 py-0.5 rounded-full ml-2",children:"失败"})]},`${l.id}-${o}`))}),e.jsx("style",{children:`
            @keyframes scroll-vertical {
              from { transform: translateY(0); }
              to { transform: translateY(-50%); }
            }
            .animate-scroll-vertical {
              /* Adjust duration based on content height */
              animation: scroll-vertical ${s.length*5}s linear infinite;
            }
          `})]})})},T=({student:t,badge:s})=>{const r=l=>{if(!l)return"";const o=new Date(l),i=o.getFullYear(),f=`${o.getMonth()+1}`.padStart(2,"0"),m=`${o.getDate()}`.padStart(2,"0");return`${i}-${f}-${m}`};return e.jsxs("div",{className:"relative w-72 h-48 flex-shrink-0 bg-slate-800/60 backdrop-blur-md border border-yellow-500/30 rounded-lg shadow-md p-4 flex flex-col justify-between text-white mx-4 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none select-none z-0",children:e.jsx("span",{className:"text-8xl font-black text-slate-500 opacity-30 transform -rotate-12 blur-sm",children:s.name})}),e.jsxs("div",{className:"relative z-10 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:s.image,alt:s.name,className:"w-20 h-20 rounded-full border-2 border-yellow-400 object-cover"}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("h3",{className:"text-lg font-bold",children:t.name}),e.jsx("p",{className:"text-md font-semibold text-yellow-300",children:s.name})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-slate-300 italic line-clamp-2",children:['"',s.description,'"']}),e.jsxs("div",{className:"border-t border-slate-700 mt-2 pt-2 text-xs text-slate-400 text-right",children:["加冕于: ",r(s.awardedDate)]})]})]})]})},O=({students:t})=>{const s=c.useMemo(()=>t.filter(l=>l.badges&&l.badges.length>0).flatMap(l=>l.badges.map(o=>({student:l,badge:o,key:`${l.id}-${o.id}`}))),[t]);if(s.length===0)return null;const r=[...s,...s];return e.jsxs("div",{className:"relative w-full overflow-hidden group h-52 -mb-2 pt-2 border-t-2 border-yellow-400/50 shadow-[0_-5px_25px_-5px_rgba(250,204,21,0.3)]",children:[e.jsx("div",{className:"absolute top-0 left-0 w-24 h-full bg-gradient-to-r from-gray-900 to-transparent z-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-24 h-full bg-gradient-to-l from-gray-900 to-transparent z-10"}),e.jsx("div",{className:"flex absolute top-4 left-0 w-max animate-scroll group-hover:pause",children:r.map(({student:l,badge:o,key:i},f)=>e.jsx(T,{student:l,badge:o},`${i}-${f}`))}),e.jsx("style",{children:`
            @keyframes scroll {
                from { transform: translateX(0); }
                to { transform: translateX(-50%); }
            }
            .animate-scroll {
                animation: scroll 50s linear infinite;
            }
            .pause {
                animation-play-state: paused;
            }
        `})]})},_=t=>t.length>4?t.slice(0,4):t,W=({pks:t,teamsMap:s})=>{const r=c.useRef(null),[l,o]=c.useState(6),[i,f]=c.useState(0),m=c.useMemo(()=>{const d=[];for(let n=0;n<t.length;n+=l)d.push(t.slice(n,n+l));return d.length>0?d:[[]]},[t,l]);return c.useEffect(()=>{const d=r.current;if(!d)return;const n=new ResizeObserver(()=>{const a=d.clientHeight,x=Math.max(3,Math.floor(a/(54+8)));o(x)});return n.observe(d),()=>n.disconnect()},[]),c.useEffect(()=>{if(m.length<=1)return;const d=setInterval(()=>f(n=>(n+1)%m.length),5e3);return()=>clearInterval(d)},[m.length]),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-xl shadow-lg h-full flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold text-center p-3 border-b border-slate-700/50",children:"PK榜"}),e.jsx("div",{ref:r,className:"p-3 flex-grow min-h-0 overflow-hidden",children:t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-slate-500",children:"暂无 PK 数据"}):e.jsx("div",{className:"flex h-full transition-transform duration-700 ease-in-out",style:{transform:`translateX(-${i*100}%)`},children:m.map((d,n)=>e.jsx("ul",{className:"w-full flex-shrink-0 h-full space-y-2",children:d.map(a=>{s.get(a.student_a),s.get(a.student_b);const h=a.status==="finished",u=h&&a.winner_id===a.student_a,x=h&&a.winner_id===a.student_b;return e.jsx("li",{className:"relative p-2 rounded-lg border border-slate-700/50 bg-slate-800/30",children:e.jsxs("div",{className:"grid grid-cols-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:`https://i.pravatar.cc/60?u=${a.student_a}`,className:"w-8 h-8 rounded-full border border-slate-600"}),e.jsx("span",{className:`text-sm font-semibold ${h?u?"text-emerald-400":"text-red-400":"text-white"}`,children:_(`学生${a.student_a}`)}),h&&(u?e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-[10px] font-bold bg-emerald-500/80 text-white rounded",children:"WIN"}):e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-[10px] font-bold bg-red-500/70 text-white rounded",children:"LOSE"}))]}),e.jsxs("div",{className:"flex items-center justify-center flex-col",children:[e.jsx("span",{className:"text-xs text-slate-500",children:"VS"}),e.jsx("span",{className:"mt-1 text-[11px] text-slate-400 truncate max-w-[140px]",children:a.topic})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("span",{className:`text-sm font-semibold ${h?x?"text-emerald-400":"text-red-400":"text-white"}`,children:_(`学生${a.student_b}`)}),h&&(x?e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-[10px] font-bold bg-emerald-500/80 text-white rounded",children:"WIN"}):e.jsx("span",{className:"ml-1 px-1.5 py-0.5 text-[10px] font-bold bg-red-500/70 text-white rounded",children:"LOSE"})),e.jsx("img",{src:`https://i.pravatar.cc/60?u=${a.student_b}`,className:"w-8 h-8 rounded-full border border-slate-600"})]})]})},a.id)})},n))})})]})};var F={};const C=typeof process<"u"&&F?"http://localhost:4000":"",U=()=>Date.now(),S=t=>U()-t*24*60*60*1e3;let K=[{id:"t1",name:"新星前锋",color:"bg-cyan-500",textColor:"text-cyan-400"},{id:"t2",name:"旋涡毒蛇",color:"bg-purple-500",textColor:"text-purple-400"},{id:"t3",name:"猩红守卫",color:"bg-red-500",textColor:"text-red-400"},{id:"t4",name:"翡翠哨兵",color:"bg-emerald-500",textColor:"text-emerald-400"}],w=[];new Date(S(2)).toISOString(),new Date(S(5)).toISOString();let X=[],Y=[],G=[];const V=async()=>{if(!C)return w;const t=await fetch(`${C}/students`);return t.ok&&(w=(await t.json()).students||[]),w},Z=async()=>K,q=async()=>Y,J=async(t=7)=>X,Q=async(t=7)=>G,ee=()=>{const[t,s]=c.useState([]),[r,l]=c.useState([]),[o,i]=c.useState([]),[f,m]=c.useState([]),[d,n]=c.useState([]);c.useEffect(()=>{Promise.all([Z(),V(),q(),J(7),Q(7)]).then(([u,x,p,g,j])=>{l(u),s(x),i(p),m(g),n(j)})},[]);const a=c.useMemo(()=>new Map(r.map(u=>[u.id,u])),[r]),h=c.useMemo(()=>[...t].sort((u,x)=>x.total_exp-u.total_exp),[t]);return e.jsxs("div",{className:"h-screen bg-gradient-to-br from-gray-900 via-slate-900 to-black text-white p-4 flex flex-col overflow-hidden",children:[e.jsx(R,{}),e.jsxs("main",{className:"mt-4 grid grid-cols-1 lg:grid-cols-3 gap-6 flex-grow min-h-0",children:[e.jsx("div",{className:"lg:col-span-2 h-full min-h-0",children:e.jsx(M,{title:"等级大厅",rightSlot:e.jsx(B,{students:t,teams:r,sortBy:"total_exp",unit:"经验"}),children:e.jsx(L,{students:h,teamsMap:a,onAvatarChange:()=>{}})})}),e.jsxs("div",{className:"lg:col-span-1 flex flex-col gap-6 h-full min-h-0",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(W,{pks:f,teamsMap:a})}),e.jsx("div",{className:"flex-grow min-h-0",children:e.jsx(A,{challenges:o})})]})]}),e.jsx("div",{className:"mt-4 grid grid-cols-1 gap-6 flex-shrink-0",children:e.jsx("div",{className:"col-span-1",children:e.jsx(O,{students:t})})})]})},te=E.createRoot(document.getElementById("root"));te.render(e.jsx(ee,{}));
